<div class="container pl-20 pr-20" id="content">
    <div class="mb-12">
        <h4 class="mt-4"> Result - {{intervention.policyName}}</h4>
    </div>
    <div class="card" style="min-height: 600px;" id="cmtool">
        <div class="p-grid p-fluid col-md-12 col-sm-12 text-title">
            <div class="row p-2" *ngFor="let item of card">
                <div class="col-3">{{item.title}} :</div>
                <div class="col-9">{{item.data}}</div>
            </div>
        </div>
        <hr>
        <div class="table-data">
        <div class="p-grid p-fluid col-md-12 col-sm-12" *ngFor="let section of sections ">
            <!-- <div class="row p-2">
                <label class="text" for=""><u><b>{{section}}</b> </u></label>
            </div> -->
            <br>
            <table>
                <tr class="table-header-left"> <p class="category-topic"><u><b>{{section}}</b> </u></p></tr>
            </table>   
            <br>
            <table> <tr></tr></table>
            <div class="row p-2">
                <p-table [value]="results[section]" sortField="question" sortMode="single" dataKey="criteria"
                    rowGroupMode="subheader" groupRowsBy="criteria" [tableStyle]="{'min-width': '70rem'}"
                    [expandedRowKeys]="expandedRows">
                    <ng-template pTemplate="header">
                        <tr>
                            <th>Question</th>
                            <th> Answer</th>
                            <th colspan="2"> Justification</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="groupheader" let-customer let-rowIndex="rowIndex" let-expanded="expanded">
                        <tr>
                            <td colspan="5">
                                <button type="button" pButton pRipple [pRowToggler]="customer"
                                    class="p-button-text p-button-rounded p-button-plain mr-2"
                                    [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"></button>
                                <!-- <img [alt]="customer.representative.name" src="https://primefaces.org/cdn/primeng/images/demo/avatar/{{customer.representative.image}}" width="32" style="vertical-align: middle" /> -->
                                <span class="font-bold ml-2">{{customer.criteria}}</span>
                            </td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="rowexpansion" let-customer>
                        <tr>
                            <td>{{customer.question}}</td>
                            <td>{{customer.answer}}</td>
                            <td>{{customer.comment}}</td>
                            <td> <a *ngIf="customer?.document" target="_blank"
                                    [href]="fileServerURL+'/'+customer?.document"><i
                                        class="pi pi-download download"></i></a></td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>
        </div>
        <table> <tr></tr></table>
        <div class="p-grid p-fluid col-12">
            <!-- <div class="row p-2">
                <label class="text"><u><b>Transformational Change Criteria</b> </u></label>
            </div> -->
            <br>
            <table>
                <tr class="table-header-left"> <p class="category-topic"><u><b>Transformational Change Criteria</b> </u> </p></tr>
            </table>   
            <!-- <p style="font-size: large;">Process of Change</p> -->
            <br>
            <table> <tr></tr></table>
            <table>
                <tr class="table-header-left"> <p style="font-size: large;">Process of Change</p></tr>
            </table>   
            <br>
            <p-table [value]="[{}]" styleClass="p-datatable-gridlines" [scrollable]="true" scrollHeight="400px" id="process-table">
                <ng-template pTemplate="header">
                    <tr>
                        <th></th>
                        <ng-container *ngFor="let data of processData.data">
                            <th [attr.colspan]="data.characteristic.length*3">{{data.name}}</th>
                        </ng-container>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-rowData>
                    <tr>
                        <ng-container *ngFor="let cat of processData.data; let i = index">
                            <ng-container *ngFor="let data of cat.characteristic; let idx = index">
                                <td *ngIf="(i === 0 && idx === 0)" rowspan="2">Relevance</td>
                                <td colspan="3">{{data.name}}</td>
                            </ng-container>
                        </ng-container>
                    </tr>
                    <tr>
                        <ng-container *ngFor="let cat of processData.data">
                            <ng-container *ngFor="let data of cat.characteristic">
                                <td colspan="3">{{getRelevance(data.relevance)}}</td>
                            </ng-container>
                        </ng-container>
                    </tr>
                    <tr>
                        <td [attr.rowspan]="processData.guidingQuestions.length + 2">Score</td>
                        <ng-container *ngFor="let cat of processData.data">
                            <ng-container *ngFor="let data of cat.characteristic">
                                <td>Guiding Question</td>
                                <td>Weight</td>
                                <td>Score</td>
                            </ng-container>
                        </ng-container>
                    </tr>
                    <ng-container *ngFor="let question of processData.guidingQuestions">
                        <tr>
                            <ng-container *ngFor="let cat of processData.data">
                                <ng-container *ngFor="let data of cat.characteristic">
                                    <td>{{question[data.name + 'question']}}</td>
                                    <td>{{question[data.name + 'weight']}}%</td>
                                    <td>{{question[data.name + 'score']}}</td>
                                </ng-container>
                            </ng-container>
                        </tr>
                    </ng-container>
                    <tr>
                        <ng-container *ngFor="let cat of processData.data">
                            <ng-container *ngFor="let data of cat.characteristic">
                                <td colspan="3">
                                    <span>
                                        {{data.name}} score: {{data.ch_score}} <br>  Weight: {{data.weight}}%
                                    </span>
                                </td>
                            </ng-container>
                        </ng-container>
                    </tr>
                    <tr>
                        <td></td>
                        <ng-container *ngFor="let data of processData.data">
                            <td [attr.colspan]="data.characteristic.length*3">
                                <span>
                                    {{data.name}} score: {{data.cat_score}} <br> Weight: {{data.weight}}%
                                </span>
                            </td>
                        </ng-container>
                    </tr>
                </ng-template>
            </p-table>
            <br>
            <table> <tr></tr></table>
            <!-- <p style="font-size: large;">Category Score - Process of change - {{score.process_score}}</p> -->
            <br>
            <table>
                <tr class="table-header-left"> <p style="font-size: large;">Category Score - Process of change - {{score.process_score}}</p></tr>
            </table>   
            <br>
            <table> <tr></tr></table>
            <!-- <p style="font-size: large;">Outcome of Change - GHG</p> -->
            <br>
            <table>
                <tr class="table-header-left"> <p style="font-size: large;">Outcome of Change - GHG</p></tr>
            </table>   
            <br>
            <div class="row p-2" *ngIf="outcomeData.scale_GHGs.length!=0">
                <p-table [value]="[{}]" id="scale-ghg">
                    <ng-template pTemplate="header">
                        <tr>
                            <th></th>
                            <th>Characteristic</th>
                            <th>Score</th>
                            <th colspan="2">Evidence Provided?</th>
                            <th>Scale/sustained score</th>
                            <th>Weight</th>
                            <th>Category Score</th>
                        </tr>
                    </ng-template>

                    <ng-template pTemplate="body" let-rowData>
                        <ng-container *ngFor="let scale_GHGs of outcomeData.scale_GHGs;let i=index">
                            <tr>
                                <td *ngIf="i === 0" [attr.rowspan]="outcomeData.scale_GHGs.length">Scale GHG</td>
                                <td>{{scale_GHGs.characteristic}}</td>
                                <td>{{(scale_GHGs?.outcome_score)?getOutcomeScores((scale_GHGs?.outcome_score),'scale_GHGs',
                                    scale_GHGs.characteristic):'-'}}</td>
                                <td>{{(scale_GHGs?.justification)?(scale_GHGs?.justification):'-'}} </td>
                                <td><a *ngIf="scale_GHGs?.document" target="_blank"
                                        [href]="fileServerURL+'/'+scale_GHGs?.document"><i
                                            class="pi pi-download download"></i></a></td>
                                <td *ngIf="i==0"
                                [attr.rowspan]="outcomeData.scale_GHGs.length" >{{score.outcome_score.scale_ghg_score}}</td> 
                                <td *ngIf="i==0" [attr.rowspan]="outcomeData.scale_GHGs.length + outcomeData.sustained_GHGs.length">{{scale_GHGs.weight}}%</td>
                                <td *ngIf="i==0" [attr.rowspan]="outcomeData.scale_GHGs.length + outcomeData.sustained_GHGs.length">{{score.outcome_score.ghg_score}}</td>
                            </tr>
                        </ng-container>
                        <ng-container *ngFor="let sustained_GHGs of outcomeData.sustained_GHGs; let i = index">
                            <tr>
                                <td *ngIf="i === 0" [attr.rowspan]="outcomeData.sustained_GHGs.length">Sustained GHG</td>
                                <td>{{changeOutcomeCharacteristicsName(sustained_GHGs.characteristic)}}</td>
                                <td>{{(sustained_GHGs?.outcome_score)?getOutcomeScores((sustained_GHGs?.outcome_score),'sustained_GHGs',
                                    sustained_GHGs.characteristic):'-'}}</td>
                                <td>{{(sustained_GHGs?.justification)?(sustained_GHGs?.justification):'-'}} </td>
                                <td><a *ngIf="sustained_GHGs?.document" target="_blank"
                                        [href]="fileServerURL+'/'+sustained_GHGs?.document"><i
                                            class="pi pi-download download"></i></a></td>
                                <td *ngIf="i==0"
                                [attr.rowspan]="outcomeData.sustained_GHGs.length" >{{score.outcome_score.sustained_ghg_score}}</td> 
                        </ng-container>
                    </ng-template>
                </p-table>
            </div>
            <table> <tr></tr></table>
            <div class="row p-2" *ngIf="outcomeData.scale_SDs.length!=0">
                <br>
                <!-- <p style="font-size: large;">Outcome of Change - SDGs</p> -->
                <br>
                <table>
                    <tr class="table-header-left"> <p style="font-size: large;">Outcome of Change - SDGs</p></tr>
                </table>   
                <br>
                <p-table [value]="[{}]">
                    <ng-template pTemplate="header">
                        <tr>
                            <th></th>
                            <th>SDG</th>
                            <th>Characteristic</th>
                            <th>Score</th>
                            <th colspan="2">Evidence Provided?</th>
                            <th>Scale/sustained score</th>
                            <th>Weight</th>
                            <th>Category Score</th>
                        </tr>
                    </ng-template>

                    <ng-template pTemplate="body" let-rowData>
                        <ng-container *ngFor="let scale_SDs of outcomeData.scale_SDs;let i=index">
                            <tr>
                                <td *ngIf="i === 0" [attr.rowspan]="outcomeData.scale_SDs.length">Scale SDG</td>
                                <td>{{getSDGName(scale_SDs?.SDG)}}</td>
                                <td>{{changeOutcomeCharacteristicsName(scale_SDs.characteristic)}}</td>
                                <td>{{(scale_SDs?.outcome_score)?getOutcomeScores((scale_SDs?.outcome_score),'scale_SDs',
                                    scale_SDs.characteristic):'-'}}</td>
                                <td>{{(scale_SDs?.justification)?(scale_SDs?.justification):'-'}} </td>
                                <td><a *ngIf="scale_SDs?.document" target="_blank"
                                        [href]="fileServerURL+'/'+scale_SDs?.document"><i
                                            class="pi pi-download download"></i></a></td>
                                <td *ngIf="i==0"
                                [attr.rowspan]="outcomeData.sustained_SDs.length" >{{score.outcome_score.sustained_sdg_score}}</td>            
                                <td *ngIf="i==0"
                                    [attr.rowspan]="outcomeData.sustained_SDs.length + outcomeData.scale_SDs.length">
                                    {{scale_SDs.weight}}%</td>
                                <td *ngIf="i==0"
                                    [attr.rowspan]="outcomeData.sustained_SDs.length + outcomeData.scale_SDs.length">
                                    {{score.outcome_score.sdg_score}}</td>
                            </tr>
                        </ng-container>
                        <ng-container *ngFor="let sustained_SDs of outcomeData.sustained_SDs; let i = index">
                            <tr>
                                <td *ngIf="i === 0" [attr.rowspan]="outcomeData.sustained_SDs.length">Sustained SDG</td>
                                <td>{{getSDGName(sustained_SDs?.SDG)}}</td>
                                <td>{{changeOutcomeCharacteristicsName(sustained_SDs.characteristic)}}</td>
                                <td>{{(sustained_SDs?.outcome_score)?getOutcomeScores((sustained_SDs?.outcome_score),'sustained_SDs',
                                    sustained_SDs.characteristic):'-'}}</td>
                                <td>{{(sustained_SDs?.justification)?(sustained_SDs?.justification):'-'}} </td>
                                <td><a *ngIf="sustained_SDs?.document" target="_blank"
                                        [href]="fileServerURL+'/'+sustained_SDs?.document"><i
                                            class="pi pi-download download"></i></a></td>
                                <td *ngIf="i==0"
                                [attr.rowspan]="outcomeData.sustained_SDs.length" >{{score.outcome_score.sustained_sdg_score}}</td>  
                            </tr>
                        </ng-container>
                    </ng-template>
                </p-table>
            </div>
            <table> <tr></tr></table>
            <div class="row p-2" *ngIf="outcomeData.scale_adaptation.length!=0">
                <br>
                <!-- <p style="font-size: large;">Outcome of Change - Adaptation Co Benifits</p> -->
                <br>
                <table>
                    <tr class="table-header-left"> <p style="font-size: large;">Outcome of Change - Adaptation Co Benifits</p></tr>
                </table>   
                <br>
                <p-table [value]="[{}]">
                    <ng-template pTemplate="header">
                        <tr>
                            <th></th>
                            <th>Characteristic</th>
                            <th>Score</th>
                            <th colspan="2">Evidence Provided?</th>
                            <th>Scale/sustained score</th>
                            <th>Weight</th>
                            <th>Category Score</th>
                        </tr>
                    </ng-template>

                    <ng-template pTemplate="body" let-rowData>
                        <!-- <tr>
                            <td [attr.rowspan]="outcomeData.scale_adaptation.length + 1">Scale Adaptation Co Benifits</td>
                        </tr> -->
                        <ng-container *ngFor="let scale_ADs of outcomeData.scale_adaptation;let i=index">
                            <tr>
                                <td *ngIf="i === 0" [attr.rowspan]="outcomeData.scale_adaptation.length">Scale Adaptation Co Benifits</td>
                                <td>{{changeOutcomeCharacteristicsName(scale_ADs.characteristic)}}</td>
                                <td>{{(scale_ADs?.outcome_score)?getOutcomeScores((scale_ADs?.outcome_score),'scale_SDs',
                                    scale_ADs.characteristic):'-'}}</td>
                                <td>{{(scale_ADs?.justification)?(scale_ADs?.justification):'-'}} </td>
                                <td><a *ngIf="scale_ADs?.document" target="_blank"
                                        [href]="fileServerURL+'/'+scale_ADs?.document"><i
                                            class="pi pi-download download"></i></a></td>
                                <td *ngIf="i==0"
                                [attr.rowspan]="outcomeData.scale_adaptation.length" >{{score.outcome_score.scale_adaptation_score}}</td> 
                                <td *ngIf="i==0"
                                    [attr.rowspan]="outcomeData.scale_adaptation.length + outcomeData.sustained_adaptation.length">
                                    {{scale_ADs.weight}}%</td>
                                <td *ngIf="i==0"
                                    [attr.rowspan]="outcomeData.scale_adaptation.length + outcomeData.sustained_adaptation.length">
                                    {{score.outcome_score.adaptation_score}}</td>
                            </tr>
                        </ng-container>
                        <!-- <tr>
                            <td [attr.rowspan]="outcomeData.sustained_adaptation.length + 1">Sustained Adaptation Co Benifits</td>
                        </tr> -->
                        <ng-container *ngFor="let sustained_ADs of outcomeData.sustained_adaptation; let i = index">
                            <tr>
                                <td *ngIf="i === 0" [attr.rowspan]="outcomeData.sustained_adaptation.length">Sustained Adaptation Co Benifits</td>
                                <td>{{changeOutcomeCharacteristicsName(sustained_ADs.characteristic)}}</td>
                                <td>{{(sustained_ADs?.outcome_score)?getOutcomeScores((sustained_ADs?.outcome_score),'sustained_SDs',
                                    sustained_ADs.characteristic):'-'}}</td>
                                <td>{{(sustained_ADs?.justification)?(sustained_ADs?.justification):'-'}} </td>
                                <td><a *ngIf="sustained_ADs?.document" target="_blank"
                                        [href]="fileServerURL+'/'+sustained_ADs?.document"><i
                                            class="pi pi-download download"></i></a></td>
                                <td *ngIf="i==0"
                                [attr.rowspan]="outcomeData.sustained_adaptation.length" >{{score.outcome_score.sustained_adaptation_score}}</td> 
                            </tr>
                        </ng-container>
                    </ng-template>
                </p-table>
            </div>
            <br>
            <table> <tr></tr></table>
            <!-- <p style="font-size: large;">Category Score - Outcome of change - {{score.outcome_score.outcome_score}}</p> -->
            <br>
                <table>
                    <tr class="table-header-left"> <p style="font-size: large;">Category Score - Outcome of change - {{score.outcome_score.outcome_score}}</p></tr>
                </table>   
                <br>
            <table *ngIf="!isDownloading" id="heatmap" class="heatmap" style="border: 1px solid black; text-align: center;">
                <tbody>
                    <tr>
                        <td></td>
                        <td colspan="8">Outcome: Extent and sustained nature of the transformation</td>
                    </tr>
                    <!-- <tr>
                        <td rowspan="7">Process: Transformational change supported</td>
                    </tr> -->
                    <tr>
                        <td rowspan="6">Process: Transformational change supported</td>
                        <td></td>
                        <ng-container *ngFor="let x of xData">
                            <td>{{x.label}}</td>
                        </ng-container>
                    </tr>
                    <tr *ngFor="let y of yData">
                        <td>{{y.label}}</td>
                        <ng-container *ngFor="let x of xData">
                            <td  [style.background-color]="getBackgroundColor(y.value+x.value)">
                                <span [ngClass]="getIntervention(x.value, y.value)? 'intervention':''">{{y.value+x.value}}</span>
                            </td>
                        </ng-container>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="p-grid p-fluid col-md-12 col-sm-12">
            <div class="row p-2">
                <div class="col-8"></div>
                <div class="col-2">
                    <button pButton pRipple type="button" label="Download Excel" (click)="toDownloadExcel()"
                        class="p-button-info" *ngIf="!isDownloading"></button>
                </div>
                <div class="col-2">
                    <button pButton pRipple type="button" label="Download PDF" (click)="toDownloadPdf()"
                        class="p-button-info" *ngIf="!isDownloading"></button>
                </div>
            </div>
        </div>
    </div>
</div>