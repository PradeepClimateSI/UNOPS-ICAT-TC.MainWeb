<p-tabView (onChange)="onMainTabChange($event) " [(activeIndex)]="activeIndexMain ">
    <p-tabPanel *ngFor="let type of types; let idx = index" header="{{type.name}}">
        <ng-template pTemplate="header">
            <span>{{type.name}}</span><i *ngIf="maintabIsValid[idx] !== undefined && !maintabIsValid[idx]" pTooltip="Mandatory fields not filled" tooltipPosition="top" class="pi pi-info-circle" style="color: red; font-size: 1rem;"></i>
        </ng-template>
        <p-tabView #tabView (onChange)="onCategoryTabChange($event)" [(activeIndex)]="activeIndex" *ngIf="type.code === 'process'">
            <p-tabPanel *ngFor="let category of categories[type.code]; let catidx = index" [header]="category.name" [selected]="category.code==assessment.processDraftLocation">
                <ng-template pTemplate="header">
                    <span>{{category.name}}</span><i *ngIf="tab1IsValid[catidx] !== undefined && !tab1IsValid[catidx]" pTooltip="Mandatory fields not filled" tooltipPosition="top" class="pi pi-info-circle" style="color: red; font-size: 1rem;"></i>
                </ng-template>
                <br>
                <p style="font-size: large;">{{category.description}}</p>
                <br>
                <ng-container *ngFor="let char of category.characteristics; let idx = index">
                    <h6>{{idx + 1}}. {{char.name === 'Research and Development' ? char.name + ' (R&D)' : char.name}}</h6>
                    <p>{{char.description}}</p>
                    <div class="row">
                        <div class="col-2">
                            <label for="Description">Relevance * <i class="pi pi-info-circle" (mouseover)="opRelevance.toggle($event)" (mouseout)="opRelevance.toggle($event)" style="font-size: 1rem"></i></label>
                        </div>
                        <div class="col-5">
                            <p-dropdown name="data_charData_relavance" #data_charData_relavance="ngModel" placeholder="Select relevance" [(ngModel)]="char.relevance" [options]="relevance" optionLabel="name" appendTo="body" optionValue="value" [required]="true"
                                (onChange)="onRelevanceChange($event, char); autoSaveResult(category.code, true, category.code, 'prose', char.id, undefined, undefined)"></p-dropdown>
                        </div>
                        <p class="info-message text-danger" *ngIf="
                                char.relevance === undefined &&
                                ((nextClicked || data_charData_relavance.touched) || (tab1IsValid[catidx] !== undefined && !tab1IsValid[catidx]))
                              ">
                            This is a mandatory field
                        </p>
                    </div>
                    <br>
                    <br>
                    <div *ngIf="char.relevance !== 0">
                        <p><strong>{{char.main_question}}</strong></p>
                        <br>
                        <p><strong><u>Guiding question(s)</u></strong></p>
                        <div *ngFor="let question of char.questions">
                            <app-cm-question [question]="question" [approach]="approach" [assessmentquestions]="assessmentquestions" [isEditMode]="isEditMode" (prev_answer)="onAnswer($event, question, category, char)"></app-cm-question>
                        </div>
                    </div>
                </ng-container>
                <div class="row justify-content-end">
                    <div>
                        <div class="d-flex flex-row-reverse mt-20 ">
                            <div class="btn btn-primary" (click)="next(category.code, category.characteristics)">
                                Next
                            </div>
                            <div style="margin-right: 10px;" class="btn btn-primary" (click)="submit(category.code, isCompleted ? false :true,category.code,'prose')">
                                {{isCompleted ? 'Update' : 'Save'}}
                            </div>
                        </div>
                    </div>
                </div>
            </p-tabPanel>
        </p-tabView>
        <p-tabView #tabView (onChange)="onCategoryTabChange2($event)" [(activeIndex)]="activeIndex2" *ngIf="type.code === 'outcome'">
            <p-tabPanel *ngFor="let category of outcome; let catidx = index" [selected]="category.code==assessment.outcomeDraftLocation">
                <ng-template pTemplate="header">
                    <span [innerHTML]="category.name"></span><i *ngIf="tabIsValid[catidx] !== undefined && !tabIsValid[catidx]" pTooltip="Mandatory fields not filled" tooltipPosition="top" class="pi pi-info-circle" style="color: red; font-size: 1rem;"></i>
                </ng-template>
                <form #fData="ngForm">
                    <ng-container *ngIf="category.type === 'GHG'">
                        <ng-container *ngFor="let char of category.results; let idx = index">
                            <h6>{{idx+1}}. {{char.characteristic.name}}</h6>
                            <p *ngIf="category.method === 'SCALE' && char.characteristic.code === 'INTERNATIONAL'">
                                <i [innerText]="GHG_scale_info.macro"></i>
                            </p>
                            <p *ngIf="category.method === 'SCALE' && char.characteristic.code === 'NATIONAL'">
                                <i [innerText]="GHG_scale_info.medium"></i>
                            </p>
                            <p *ngIf="category.method === 'SCALE' && char.characteristic.code === 'SUBNATIONAL'">
                                <i [innerText]="GHG_scale_info.micro"></i>
                            </p>
                            <ng-container *ngIf="category.method === 'SCALE' && char.characteristic.code === 'NATIONAL'">
                                <p><i [innerText]="sectoral_description"></i></p>
                                <p><a target="_blank" href="https://www.ipcc-nggip.iges.or.jp/public/2006gl/pdf/1_Volume1/V1_4_Ch4_MethodChoice.pdf">Chapter 4 - Methodological choice and Identification of key categories </a></p>
                                <p><a target="_blank" href="https://unfccc.int/process-and-meetings/transparency-and-reporting/reporting-and-review/reporting-and-review-under-the-paris-agreement/national-inventory-reports">National inventory reports</a></p>
                                <p><a target="_blank" href="https://unfccc.int/non-annex-I-NCs?psafe_param=1&gad_source=1&gclid=CjwKCAiAlJKuBhAdEiwAnZb7ld5rCNwYr_3YUGFNjcZVY8belZMnWpNOggJZePrFCqaJ-RVnD8H66BoCGQIQAvD_BwE">National communication submissions from non-annex i parties</a></p>
                                <p><a target="_blank" href="https://unfccc.int/process-and-meetings/transparency-and-reporting/preparing-for-the-ETF">Preparing for the enhanced transparency framework</a></p>
                            </ng-container>
                            <ng-container *ngIf="category.method === 'SCALE' && char.characteristic.code === 'SUBNATIONAL'">
                                <p><i [innerText]="sectoral_description"></i></p>
                                <p><a target="_blank" href="https://www.ipcc-nggip.iges.or.jp/public/2006gl/pdf/1_Volume1/V1_4_Ch4_MethodChoice.pdf">Chapter 4 - Methodological choice and identification of key categories </a></p>
                            </ng-container>
                            <ng-container *ngIf="category.method === 'SCALE'">
                                <div class="row p-2">
                                    <div class="col-4">Starting situation</div>
                                    <div class="col-8">
                                        <div class="row">
                                            <div [ngClass]="char.characteristic.code === 'INTERNATIONAL' ? 'col-9' : 'col-12'">
                                                <ng-container *ngIf="!(useDefault[char.characteristic.id] && useDefault[char.characteristic.id].st_default) || char.characteristic.code !== 'INTERNATIONAL'">
                                                    <input type="text" [name]="'stSituation'+char.characteristic.id" #tboundrary="ngModel"
                                                        [placeholder]="char.characteristic.code === 'INTERNATIONAL' ? ghg_starting_situation_placeholder.international : (char.characteristic.code === 'NATIONAL' ? ghg_starting_situation_placeholder.national : ghg_starting_situation_placeholder.subNational)"
                                                        [(ngModel)]="char.startingSituation" class="form-control" [required]="true" 
                                                        (mouseleave)="autoSaveResult(category.code, true, category.code, 'out', char.characteristic.id, undefined, undefined)" />
                                                    <p class="info-message text-danger" *ngIf="((fData.form.controls['stSituation'+char.characteristic.id]?.touched ? 
                                                            (char.startingSituation === undefined || char.startingSituation === '' || char.startingSituation === null)
                                                        : (char.startingSituation === undefined || char.startingSituation === null) && clickedFormMap[activeIndex2] || tabIsValid[catidx] !== undefined && !tabIsValid[catidx]))
                                                        ">
                                                        This is a mandatory field
                                                    </p>
                                                </ng-container>
                                                <ng-container *ngIf="(useDefault[char.characteristic.id] && useDefault[char.characteristic.id].st_default) && char.characteristic.code === 'INTERNATIONAL'">
                                                    <p-dropdown
                                                        [placeholder]="char.characteristic.code === 'INTERNATIONAL' ? ghg_starting_situation_placeholder.international : (char.characteristic.code === 'NATIONAL' ? ghg_starting_situation_placeholder.national : ghg_starting_situation_placeholder.subNational)"
                                                        [options]="default_values[char.characteristic.id]? default_values[char.characteristic.id].st_default_values : []" [name]="'st_default_values'+char.characteristic.code" [required]="true"
                                                        [(ngModel)]="startingSituation" optionLabel="label" (onChange)="onSelectDefault($event, char); autoSaveResult(category.code, true, category.code, 'out', char.characteristic.id, undefined, undefined)">
                                                    </p-dropdown>
                                                </ng-container>
                                            </div>
                                            <div class="col-3" *ngIf="char.characteristic.code === 'INTERNATIONAL' && useDefault[char.characteristic.id]">
                                                <p-checkbox [name]="'st-checkbox' + char.characteristic.code" [(ngModel)]="useDefault[char.characteristic.id].st_default" [binary]="true" inputId="binary" label="Default Values"
                                                    (onChange)="loadDefaults(char.characteristic.id, 'STARTING_SITUATION')"></p-checkbox>
                                                <i class="pi pi-info-circle" [pTooltip]="source" tooltipPosition="bottom" style="font-size: 1rem"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row p-2">
                                    <div class="col-4">Expected impact</div>
                                    <div class="col-8">
                                        <input type="text" [name]="'impact'+char.characteristic.id" #tboundrary="ngModel" placeholder="Please describe the expected emissions reductions on the indicated scale." [(ngModel)]="char.expectedImpact" class="form-control"
                                            [required]="true" (mouseleave)="autoSaveResult(category.code, true, category.code, 'out', char.characteristic.id, undefined, undefined)"/>
                                        <p class="info-message text-danger" *ngIf="((fData.form.controls['impact'+char.characteristic.id]?.touched ? 
                                                    (char.expectedImpact === undefined || char.expectedImpact === '' || char.expectedImpact === null)
                                                : (char.expectedImpact === undefined || char.expectedImpact === null) && clickedFormMap[activeIndex2] || tabIsValid[catidx] !== undefined && !tabIsValid[catidx]))
                                                ">
                                            This is a mandatory field
                                        </p>
                                    </div>
                                </div>
                                <div class="row p-2">
                                    <div class="col-4">Score</div>
                                    <div class="col-6">
                                        <p-dropdown *ngIf="approach !== 'INDIRECT'" [name]="'score'+char.characteristic.id" #type="ngModel" placeholder="Select score" [(ngModel)]="char.selectedScore" [virtualScroll]="true" [virtualScrollItemSize]="20" [style]="{'width': '100%'}"
                                            [options]="char.characteristic.code === 'INTERNATIONAL' ? GHG_scale_score_macro : (char.characteristic.code === 'NATIONAL' ? GHG_scale_score_medium : GHG_scale_score_micro)" [required]="true" appendTo="body"
                                            (onChange)="onSelectScore($event, char, idx, category.type);autoSaveResult(category.code, true, category.code, 'out', char.characteristic.id, undefined, undefined)" optionLabel="name">
                                            <ng-template let-option pTemplate="item">
                                                <div class="custom-option">
                                                    {{ option.name }}
                                                </div>
                                            </ng-template>
                                        </p-dropdown>
                                        <p class="info-message text-danger" *ngIf="((fData.form.controls['score'+char.characteristic.id]?.touched ? 
                                                (char.selectedScore.code === undefined || char.selectedScore.code === '' )
                                            : char.selectedScore.code === undefined && clickedFormMap[activeIndex2] || tabIsValid[catidx] !== undefined && !tabIsValid[catidx]))
                                            ">
                                            This is a mandatory field
                                        </p>
                                        <p-dropdown *ngIf="approach === 'INDIRECT'" name="institution" [options]="institutions" [(ngModel)]="char.institution" #finstitution="ngModel" placeholder="Select an institution" optionLabel="name" [required]="true"></p-dropdown>
                                    </div>
                                </div>
                                <div class="row p-2">
                                    <div class="col-4">Justification <i *ngIf="['NATIONAL', 'SUBNATIONAL'].includes(char.characteristic.code)" class="pi pi-info-circle" pTooltip="{{char.characteristic.code === 'NATIONAL' ? sectoral_placeholder : subsectoral_placeholder}}" tooltipPosition="bottom"
                                            style="font-size: 1rem"></i></div>
                                    <div class="col-6">
                                        <textarea type="text" rows="5" [name]="'justification'+char.characteristic.id" #tboundrary="ngModel" [(ngModel)]="char.comment" class="form-control" [placeholder]="char.characteristic.code === 'INTERNATIONAL' ? 'Enter justification' : ''"
                                            [required]="true" [maxlength]="masterDataService.getFieldCharCount(fieldNames.JUSTIFICATION)"
                                            (mouseleave)="autoSaveResult(category.code, true, category.code, 'out', char.characteristic.id, undefined, undefined)"></textarea>
                                        <span style="font-size: 1rem; float: right;">Maximum characters {{masterDataService.getFieldCharCount(fieldNames.JUSTIFICATION)}}</span>
                                        <p class="info-message text-danger" *ngIf="((fData.form.controls['justification'+char.characteristic.id]?.touched ? 
                                                    (char.comment === undefined || char.comment === '' || char.comment === null)
                                                : (char.comment === undefined || char.comment === null) && clickedFormMap[activeIndex2] || tabIsValid[catidx] !== undefined && !tabIsValid[catidx]))
                                                ">
                                            This is a mandatory field
                                        </p>
                                    </div>
                                    <div class="col-2">
                                        <p-fileUpload mode="basic" chooseIcon="pi pi-upload" chooseLabel="Upload" name="files" [url]="uploadUrl" (onUpload)="onUpload($event,char);autoSaveResult(category.code, true, category.name, 'out', char.characteristic.id, undefined, undefined)" [multiple]="true" accept="{{acceptedFiles}}" [maxFileSize]="5000000" [auto]="true">
                                        </p-fileUpload>
                                    </div>
                                </div>
                                <div class="row p-2" *ngIf="char.filePath">
                                    <div class="col-4"></div>
                                    <div class="col-4">
                                        <p class="col-5">{{char.filePath}}</p>
                                    </div>
                                    <div class="col-4">
                                        <a target="_blank" [href]="fileServerURL+'/'+char.filePath"><i class="pi pi-download download col-4"></i></a>
                                    </div>
                                </div>
                            </ng-container>
                            <ng-container *ngIf="category.method === 'SUSTAINED'">
                                <p>Is the intervention’s GHG outcome sustained over time, i.e. the mitigation continues to accrue beyond the crediting period? Note: this is different from permanence of the achieved mitigation</p>
                                <div class="row p-2">
                                    <div class="col-4">Score</div>
                                    <div class="col-6">
                                        <p-dropdown *ngIf="approach !== 'INDIRECT'" [name]="'score'+char.characteristic.id" #scoreee="ngModel" placeholder="Select score" [(ngModel)]="char.selectedScore" [virtualScroll]="true" [virtualScrollItemSize]="20" [style]="{'width': '100%'}"
                                            [options]="GHG_sustained_score" optionLabel="name" [required]="true" appendTo="body" (onChange)="onSelectScore($event, char, idx, category.type); autoSaveResult(category.code, true, category.code, 'out', char.characteristic.id, undefined, undefined)">
                                            <ng-template let-option pTemplate="item">
                                                <div class="custom-option">
                                                    {{ option.name }}
                                                </div>
                                            </ng-template>
                                        </p-dropdown>
                                        <p class="info-message text-danger" *ngIf="((fData.form.controls['score'+char.characteristic.id]?.touched ? 
                                                (char.selectedScore.code === undefined || char.selectedScore.code === '')
                                            : char.selectedScore.code === undefined && clickedFormMap[activeIndex2] || tabIsValid[catidx] !== undefined && !tabIsValid[catidx]))
                                            ">
                                            This is a mandatory field
                                        </p>
                                        <p-dropdown *ngIf="approach === 'INDIRECT'" name="institution" [options]="institutions" [(ngModel)]="char.institution" #finstitution="ngModel" placeholder="Select an institution" optionLabel="name" [required]="true"></p-dropdown>
                                    </div>
                                </div>
                                <div class="row p-2">
                                    <div class="col-4">Justification</div>
                                    <div class="col-6">
                                        <textarea rows="5" type="text" [name]="'justification'+char.characteristic.id" #tboundrary="ngModel" [(ngModel)]="char.comment" class="form-control" placeholder="Enter justification" [required]="true"
                                            [maxlength]="masterDataService.getFieldCharCount(fieldNames.JUSTIFICATION)" (mouseleave)="autoSaveResult(category.code, true, category.code, 'out', char.characteristic.id, undefined, undefined)"></textarea>
                                        <span style="font-size: 1rem; float: right;">Maximum characters {{masterDataService.getFieldCharCount(fieldNames.JUSTIFICATION)}}</span>
                                        <p class="info-message text-danger" *ngIf="((fData.form.controls['justification'+char.characteristic.id]?.touched ? 
                                                    (char.comment === undefined || char.comment === '' || char.comment === null)
                                                : (char.comment === undefined || char.comment === null) && clickedFormMap[activeIndex2] || tabIsValid[catidx] !== undefined && !tabIsValid[catidx]))
                                                ">
                                            This is a mandatory field
                                        </p>
                                    </div>
                                    <div class="col-2">
                                        <p-fileUpload mode="basic" chooseIcon="pi pi-upload" chooseLabel="Upload" name="files" [url]="uploadUrl" (onUpload)="onUpload($event,char);autoSaveResult(category.code, true, category.code, 'out', char.characteristic.id, undefined, undefined)" [multiple]="true" accept="{{acceptedFiles}}" [maxFileSize]="5000000" [auto]="true">
                                        </p-fileUpload>
                                    </div>
                                </div>
                                <div class="row p-2" *ngIf="char.filePath">
                                    <div class="col-4"></div>
                                    <div class="col-4">
                                        <p class="col-5">{{char.filePath}}</p>
                                    </div>
                                    <div class="col-4">
                                        <a target="_blank" [href]="fileServerURL+'/'+char.filePath"><i class="pi pi-download download col-4"></i></a>
                                    </div>
                                </div>
                            </ng-container>
                        </ng-container>
                        <ng-container *ngIf="category.method === 'SCALE'">
                            <div class=" p-2">
                                <label>Expected average GHG reductions or removals (mitigation outcomes) (tCO₂e/year)</label>
                                <div class="col-8">
                                    <p-inputNumber [(ngModel)]="expected_ghg_mitigation" name="expected_ghg_mitigation" placeholder="Expected average GHG reductions or removals (mitigation outcomes)" inputId="locale-us" mode="decimal" locale="en-US" [minFractionDigits]="2"
                                    (onInput)="autoSaveResult(category.code, true, category.code, 'reduction', undefined, undefined, undefined)">
                                    </p-inputNumber>
                                </div>
                            </div>
                            <div  class=" p-2">
                                <p> <br><br>
                                    Note: All GHG impacts should be calculated as average reductions in emissions in tCO₂e/year (over the intervention's lifetime) and compared
                                     to subnational/regional/municipal emissions or subsectoral level emissions for the latest year for which those emissions data is available.
                                  </p>
                            </div>
                        </ng-container>
                        <ng-container *ngIf="category.method === 'SUSTAINED'">
                            <h6>GHG Answer</h6>
                            <div class="row p-2">
                                <div class="col-4">Aggregated Answer</div>
                                <div class="col-8">
                                    <input type="text" name="ghgScore" #tboundrary="ngModel" disabled="true" [(ngModel)]="GHGScore" class="form-control" />
                                </div>
                            </div>
                        </ng-container>
                        <div class="row justify-content-end">
                            <div>
                                <div class="d-flex flex-row-reverse mt-20 " *ngIf="activeIndex2 < outcome.length - 1">
                                    <div class="btn btn-primary" (click)="next(category.type+'_'+category.method)">
                                        Next
                                    </div>
                                    <div style="margin-right: 10px;" class="btn btn-primary" (click)="submit(category.type+'_'+category.method, isCompleted ? false : true,category.code,'out')">
                                        {{isCompleted ? 'Update' : 'Save'}}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </ng-container>
                    <ng-container *ngIf="category.type === 'ADAPTATION'">
                        <ng-container *ngFor="let char of category.results; let idx = index">
                            <h6>{{idx+1}}. {{char.characteristic.name}}</h6>
                            <p *ngIf="category.method === 'SCALE' && char.characteristic.code === 'INTERNATIONAL'">
                                <i [innerText]="adaptation_scale_info.macro"></i>
                            </p>
                            <p *ngIf="category.method === 'SCALE' && char.characteristic.code === 'NATIONAL'">
                                <i [innerText]="adaptation_scale_info.medium"></i>
                            </p>
                            <p *ngIf="category.method === 'SCALE' && char.characteristic.code === 'SUBNATIONAL'">
                                <i [innerText]="adaptation_scale_info.micro"></i>
                            </p>
                            <ng-container *ngIf="category.method === 'SCALE' && char.characteristic.code === 'NATIONAL'">
                                <p><i [innerText]="sectoral_description"></i></p>
                                <p><a target="_blank" href="https://www.ipcc-nggip.iges.or.jp/public/2006gl/pdf/1_Volume1/V1_4_Ch4_MethodChoice.pdf">Chapter 4 - Methodological choice and identification of key categories </a></p>
                                <p><a target="_blank" href="https://unfccc.int/process-and-meetings/transparency-and-reporting/reporting-and-review/reporting-and-review-under-the-paris-agreement/national-inventory-reports">National inventory reports</a></p>
                                <p><a target="_blank" href="https://unfccc.int/non-annex-I-NCs?psafe_param=1&gad_source=1&gclid=CjwKCAiAlJKuBhAdEiwAnZb7ld5rCNwYr_3YUGFNjcZVY8belZMnWpNOggJZePrFCqaJ-RVnD8H66BoCGQIQAvD_BwE">National communication submissions from non-annex i parties</a></p>
                                <p><a target="_blank" href="https://unfccc.int/process-and-meetings/transparency-and-reporting/preparing-for-the-ETF">Preparing for the enhanced transparency framework</a></p>
                            </ng-container>
                            <ng-container *ngIf="category.method === 'SCALE' && char.characteristic.code === 'SUBNATIONAL'">
                                <p><i [innerText]="sectoral_description"></i></p>
                                <p><a target="_blank" href="https://www.ipcc-nggip.iges.or.jp/public/2006gl/pdf/1_Volume1/V1_4_Ch4_MethodChoice.pdf">Chapter 4 - Methodological choice and identification of key categories </a></p>
                            </ng-container>
                            <ng-container *ngIf="category.method === 'SCALE'">
                                <div class="row p-2">
                                    <div class="col-4">Adaptation co-benifit <i class="pi pi-info-circle" pTooltip="{{adaptation_tooltip}}" tooltipPosition="bottom" style="font-size: 1rem"></i></div>
                                    <div class="col-8">
                                        <input type="text" [name]="'benifit'+char.characteristic.id" #tboundrary="ngModel" [(ngModel)]="char.adaptationCoBenifit" class="form-control" [required]="true"
                                        (mouseleave)="autoSaveResult(category.code, true, category.code, 'out', char.characteristic.id, undefined, undefined)" />
                                        <p class="info-message text-danger" *ngIf="((fData.form.controls['benifit'+char.characteristic.id]?.touched ? 
                                                (char.adaptationCoBenifit === undefined || char.adaptationCoBenifit === '' || char.adaptationCoBenifit === null)
                                            : (char.adaptationCoBenifit === undefined || char.adaptationCoBenifit === null) && clickedFormMap[activeIndex2] || tabIsValid[catidx] !== undefined && !tabIsValid[catidx]))
                                            ">
                                            This is a mandatory field
                                        </p>
                                    </div>
                                </div>
                                <div class="row p-2">
                                    <div class="col-4">Starting situation <i class="pi pi-info-circle" pTooltip="{{starting_situation_tooltip}}" tooltipPosition="bottom" style="font-size: 1rem"></i></div>
                                    <div class="col-8">
                                        <input type="text" [name]="'stSituation'+char.characteristic.id" #tboundrary="ngModel"
                                            [placeholder]="char.characteristic.code === 'INTERNATIONAL' ? ghg_starting_situation_placeholder.international : (char.characteristic.code === 'NATIONAL' ? ghg_starting_situation_placeholder.national : ghg_starting_situation_placeholder.subNational)"
                                            [(ngModel)]="char.startingSituation" class="form-control" [required]="true" (mouseleave)="autoSaveResult(category.code, true, category.code, 'out', char.characteristic.id, undefined, undefined)" />
                                        <p class="info-message text-danger" *ngIf="((fData.form.controls['stSituation'+char.characteristic.id]?.touched ? 
                                                (char.startingSituation === undefined || char.startingSituation === '' || char.startingSituation === null)
                                            : (char.startingSituation === undefined  || char.startingSituation === null) && clickedFormMap[activeIndex2] || tabIsValid[catidx] !== undefined && !tabIsValid[catidx]))
                                            ">
                                            This is a mandatory field
                                        </p>
                                    </div>
                                </div>
                                <div class="row p-2">
                                    <div class="col-4">Expected impact <i class="pi pi-info-circle" pTooltip="{{expected_impact_tooltip}}" tooltipPosition="bottom" style="font-size: 1rem"></i></div>
                                    <div class="col-8">
                                        <input type="text" [name]="'impact'+char.characteristic.id" #tboundrary="ngModel" placeholder="Please describe the expected emissions reductions on the indicated scale." [(ngModel)]="char.expectedImpact" class="form-control"
                                            [required]="true" (mouseleave)="autoSaveResult(category.code, true, category.code, 'out', char.characteristic.id, undefined, undefined)"/>
                                        <p class="info-message text-danger" *ngIf="((fData.form.controls['impact'+char.characteristic.id]?.touched ? 
                                                    (char.expectedImpact === undefined || char.expectedImpact === '' || char.expectedImpact === null)
                                                : (char.expectedImpact === undefined || char.expectedImpact === null) && clickedFormMap[activeIndex2] || tabIsValid[catidx] !== undefined && !tabIsValid[catidx]))
                                                ">
                                            This is a mandatory field
                                        </p>
                                    </div>
                                </div>
                                <div class="row p-2">
                                    <div class="col-4">Score</div>
                                    <div class="col-6">
                                        <p-dropdown *ngIf="approach !== 'INDIRECT'" [name]="'score'+char.characteristic.id" #type="ngModel" placeholder="Select score" [(ngModel)]="char.selectedScore" [options]="adaptation_scale_score" [virtualScroll]="true" [virtualScrollItemSize]="20"
                                            [style]="{'width': '100%'}" optionLabel="name" [required]="true" appendTo="body" (onChange)="onSelectScore($event, char, idx, category.type);autoSaveResult(category.code, true, category.code, 'out', char.characteristic.id, undefined, undefined)">
                                            <ng-template let-option pTemplate="item">
                                                <div class="custom-option">
                                                    {{ option.name }}
                                                </div>
                                            </ng-template>
                                        </p-dropdown>
                                        <p class="info-message text-danger" *ngIf="((fData.form.controls['score'+char.characteristic.id]?.touched ? 
                                                (char.selectedScore.code === undefined || char.selectedScore.code === '')
                                            : char.selectedScore.code === undefined && clickedFormMap[activeIndex2] || tabIsValid[catidx] !== undefined && !tabIsValid[catidx]))
                                            ">
                                            This is a mandatory field
                                        </p>
                                        <p-dropdown *ngIf="approach === 'INDIRECT'" name="institution" [options]="institutions" [(ngModel)]="char.institution" #finstitution="ngModel" placeholder="Select an institution" optionLabel="name" [required]="true"></p-dropdown>
                                    </div>
                                </div>
                                <div class="row p-2">
                                    <div class="col-4">Justification <i *ngIf="['NATIONAL', 'SUBNATIONAL'].includes(char.characteristic.code)" class="pi pi-info-circle" pTooltip="{{char.characteristic.code === 'NATIONAL' ? sectoral_placeholder : subsectoral_placeholder}}" tooltipPosition="bottom"
                                            style="font-size: 1rem"></i></div>
                                    <div class="col-6">
                                        <textarea rows="5" type="text" [name]="'justification'+char.characteristic.id" #tboundrary="ngModel" [(ngModel)]="char.comment" class="form-control" [placeholder]="char.characteristic.code === 'INTERNATIONAL' ? 'Enter justification' : ''"
                                            [required]="true" [maxlength]="masterDataService.getFieldCharCount(fieldNames.JUSTIFICATION)" (mouseleave)="autoSaveResult(category.code, true, category.code, 'out', char.characteristic.id, undefined, undefined)"></textarea>
                                        <span style="font-size: 1rem; float: right;">Maximum characters {{masterDataService.getFieldCharCount(fieldNames.JUSTIFICATION)}}</span>
                                        <p class="info-message text-danger" *ngIf="((fData.form.controls['justification'+char.characteristic.id]?.touched ? 
                                                (char.comment === undefined || char.comment === '' || char.comment === null)
                                            : (char.comment === undefined || char.comment === null) && clickedFormMap[activeIndex2] || tabIsValid[catidx] !== undefined && !tabIsValid[catidx]))
                                            ">
                                            This is a mandatory field
                                        </p>
                                    </div>
                                    <div class="col-2">
                                        <p-fileUpload mode="basic" chooseIcon="pi pi-upload" chooseLabel="Upload" name="files" [url]="uploadUrl" (onUpload)="onUpload($event,char);autoSaveResult(category.code, true, category.code, 'out', char.characteristic.id, undefined, undefined)" [multiple]="true" accept="{{acceptedFiles}}" [maxFileSize]="5000000" [auto]="true">
                                        </p-fileUpload>
                                    </div>
                                </div>
                                <div class="row p-2" *ngIf="char.filePath">
                                    <div class="col-4"></div>
                                    <div class="col-4">
                                        <p class="col-5">{{char.filePath}}</p>
                                    </div>
                                    <div class="col-4">
                                        <a target="_blank" [href]="fileServerURL+'/'+char.filePath"><i class="pi pi-download download col-4"></i></a>
                                    </div>
                                </div>
                            </ng-container>
                            <ng-container *ngIf="category.method === 'SUSTAINED'">
                                <p>Is the intervention’s contribution to the adaptation co-benefit sustained in nature?</p>
                                <div class="row p-2">
                                    <div class="col-4">Score</div>
                                    <div class="col-6">
                                        <p-dropdown *ngIf="approach !== 'INDIRECT'" [name]="'score'+char.characteristic.id" #type="ngModel" placeholder="Select score" [(ngModel)]="char.selectedScore" [options]="adaptation_sustained_score" optionLabel="name"
                                            [required]="true" appendTo="body" [virtualScroll]="true" [virtualScrollItemSize]="20" [style]="{'width': '100%'}" (onChange)="onSelectScore($event, char, idx, category.type);autoSaveResult(category.code, true, category.code, 'out', char.characteristic.id, undefined, undefined)">
                                            <ng-template let-option pTemplate="item">
                                                <div class="custom-option">
                                                    {{ option.name }}
                                                </div>
                                            </ng-template>
                                        </p-dropdown>
                                        <p class="info-message text-danger" *ngIf="((fData.form.controls['score'+char.characteristic.id]?.touched ? 
                                            (char.selectedScore.code === undefined || char.selectedScore.code === '' || char.selectedScore.code === null)
                                        : (char.selectedScore.code === undefined  || char.selectedScore.code === null) && clickedFormMap[activeIndex2] || tabIsValid[catidx] !== undefined && !tabIsValid[catidx]))
                                        ">
                                            This is a mandatory field
                                        </p>
                                        <p-dropdown *ngIf="approach === 'INDIRECT'" name="institution" [options]="institutions" [(ngModel)]="char.institution" #finstitution="ngModel" placeholder="Select an institution" optionLabel="name" [required]="true"></p-dropdown>
                                    </div>
                                </div>
                                <div class="row p-2">
                                    <div class="col-4">Justification</div>
                                    <div class="col-6">
                                        <textarea rows="5" type="text" [name]="'justification'+char.characteristic.id" #tboundrary="ngModel" [(ngModel)]="char.comment" class="form-control" placeholder="Enter justification" [required]="true"
                                            [maxlength]="masterDataService.getFieldCharCount(fieldNames.JUSTIFICATION)" (mouseleave)="adaptationJustificationChange();autoSaveResult(category.code, true, category.code, 'out', char.characteristic.id, undefined, undefined)"></textarea>
                                        <span style="font-size: 1rem; float: right;">Maximum characters {{masterDataService.getFieldCharCount(fieldNames.JUSTIFICATION)}}</span>
                                        <p class="info-message text-danger" *ngIf="((fData.form.controls['justification'+char.characteristic.id]?.touched ? 
                                                (char.comment === undefined || char.comment === '' || char.comment === null)
                                            : (char.comment === undefined  || char.comment === null) && clickedFormMap[activeIndex2] || tabIsValid[catidx] !== undefined && !tabIsValid[catidx]))
                                            ">
                                            This is a mandatory field
                                        </p>
                                    </div>
                                    <div class="col-2">
                                        <p-fileUpload mode="basic" chooseIcon="pi pi-upload" chooseLabel="Upload" name="files" [url]="uploadUrl" (onUpload)="onUpload($event,char);autoSaveResult(category.code, true, category.code, 'out', char.characteristic.id, undefined, undefined)" [multiple]="true" accept="{{acceptedFiles}}" [maxFileSize]="5000000" [auto]="true">
                                        </p-fileUpload>
                                    </div>
                                </div>
                                <div class="row p-2" *ngIf="char.filePath">
                                    <div class="col-4"></div>
                                    <div class="col-4">
                                        <p class="col-5">{{char.filePath}}</p>
                                    </div>
                                    <div class="col-4">
                                        <a target="_blank" [href]="fileServerURL+'/'+char.filePath"><i class="pi pi-download download col-4"></i></a>
                                    </div>
                                </div>
                            </ng-container>
                        </ng-container>
                        <ng-container *ngIf="category.method === 'SUSTAINED'">
                            <h6>Adaptation Answer</h6>
                            <div class="row p-2">
                                <div class="col-4">Aggregated Answer</div>
                                <div class="col-8">
                                    <input type="text" name="adaptationScore" #tboundrary="ngModel" disabled="true" [(ngModel)]="adaptationScore" class="form-control" />
                                </div>
                            </div>
                        </ng-container>
                        <div class="row justify-content-end">
                            <div>
                                <div class="d-flex flex-row-reverse mt-20 ">
                                    <div *ngIf="activeIndex2 < outcome.length - 1" class="btn btn-primary" (click)="next(category.type+'_'+category.method)">
                                        Next
                                    </div>
                                    <div style="margin-right: 10px;" class="btn btn-primary" (click)="submit(category.type+'_'+category.method, isCompleted ? false : true,category.code,'out')">
                                        {{isCompleted ? 'Update' : 'Save'}}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </ng-container>
                    <ng-container *ngIf="category.type === 'SD'">
                        <div class="row p-2">
                            <div class="col-4">Choose SDG</div>
                            <div class="col-8">
                                <p-multiSelect name="impact_categories" placeholder="Select SDG(s)" appendTo="body" [options]="sdgList" [(ngModel)]="selectedSDGsList" optionLabel="name" (onChange)="onSelectSDG($event); autoSaveResult('SCALE_SD', true, 'SCALE_SD', 'out', undefined, undefined, undefined)" [disabled]="category.method === 'SUSTAINED'">
                                </p-multiSelect>
                            </div>
                        </div>
                        <ng-container selectedSDGs && selectedSDGs.length>
                            <ng-container *ngFor="let SDG of selectedSDGs; let sidx = index">
                                <h5> SDG {{SDG.number}} - {{SDG.name}}</h5>
                                <div class="card">
                                    <ng-container *ngIf="category.method === 'SCALE'">
                                        <ng-container *ngFor="let char of SDG.scaleResult; let idx = index;">
                                            <h6>{{idx+1}}. {{char.characteristic.name}}</h6>
                                            <p *ngIf="char.characteristic.code === 'INTERNATIONAL'">
                                                <i [innerText]="SD_scale_info.macro"></i>
                                            </p>
                                            <p *ngIf="char.characteristic.code === 'NATIONAL'">
                                                <i [innerText]="SD_scale_info.medium"></i>
                                            </p>
                                            <p *ngIf="char.characteristic.code === 'SUBNATIONAL'">
                                                <i [innerText]="SD_scale_info.micro"></i>
                                            </p>
                                            <ng-container *ngIf="category.method === 'SCALE' && char.characteristic.code === 'NATIONAL'">
                                                <p><i [innerText]="sectoral_description"></i></p>
                                                <p><a target="_blank" href="https://www.ipcc-nggip.iges.or.jp/public/2006gl/pdf/1_Volume1/V1_4_Ch4_MethodChoice.pdf">Chapter 4 - Methodological choice and identification of key categories </a></p>
                                                <p><a target="_blank" href="https://unfccc.int/process-and-meetings/transparency-and-reporting/reporting-and-review/reporting-and-review-under-the-paris-agreement/national-inventory-reports">National inventory reports</a></p>
                                                <p><a target="_blank" href="https://unfccc.int/non-annex-I-NCs?psafe_param=1&gad_source=1&gclid=CjwKCAiAlJKuBhAdEiwAnZb7ld5rCNwYr_3YUGFNjcZVY8belZMnWpNOggJZePrFCqaJ-RVnD8H66BoCGQIQAvD_BwE">National communication submissions from non-annex i parties</a>
                                                </p>
                                                <p><a target="_blank" href="https://unfccc.int/process-and-meetings/transparency-and-reporting/preparing-for-the-ETF">Preparing for the enhanced transparency framework</a></p>
                                            </ng-container>
                                            <ng-container *ngIf="category.method === 'SCALE' && char.characteristic.code === 'SUBNATIONAL'">
                                                <p><i [innerText]="sectoral_description"></i></p>
                                                <p><a target="_blank" href="https://www.ipcc-nggip.iges.or.jp/public/2006gl/pdf/1_Volume1/V1_4_Ch4_MethodChoice.pdf">Chapter 4 - Methodological choice and identification of key categories </a></p>
                                            </ng-container>
                                            <div class="row p-2">
                                                <div class="col-4">SDG Indicator <i class="pi pi-info-circle" pTooltip="Please describe the indicator used to assess the contribution to the selected SDG (i.e. number of jobs created)." tooltipPosition="bottom" style="font-size: 1rem"></i></div>
                                                <div class="col-8">
                                                    <input type="text" [name]="'indicator'+SDG.code+char.characteristic.id" [(ngModel)]="char.sdgIndicator" class="form-control" placeholder="" [required]="true" 
                                                    (mouseleave)="autoSaveResult(category.code, true, category.code, 'out', char.characteristic.id, undefined, SDG.id)"/>
                                                    <p class="info-message text-danger" *ngIf="((fData.form.controls['indicator'+SDG.code+char.characteristic.id]?.touched ? 
                                                            (char.sdgIndicator === undefined || char.sdgIndicator === '' || char.sdgIndicator === null)
                                                        : (char.sdgIndicator === undefined || char.sdgIndicator === null) && clickedFormMap[activeIndex2]  || tabIsValid[catidx] !== undefined && !tabIsValid[catidx]))
                                                        ">
                                                        This is a mandatory field
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="row p-2">
                                                <div class="col-4">Starting situation <i class="pi pi-info-circle" pTooltip="Please describe the value of the indicator before intervention implementation." tooltipPosition="bottom" style="font-size: 1rem"></i></div>
                                                <div class="col-8">
                                                    <input type="text" [name]="'stSituation'+char.characteristic.id+SDG.id" #tboundrary="ngModel"
                                                        [placeholder]="char.characteristic.code === 'INTERNATIONAL' ? ghg_starting_situation_placeholder.international : (char.characteristic.code === 'NATIONAL' ? ghg_starting_situation_placeholder.national : ghg_starting_situation_placeholder.subNational)"
                                                        [(ngModel)]="char.startingSituation" class="form-control" [required]="true" (mouseleave)="autoSaveResult(category.code, true, category.code, 'out', char.characteristic.id, undefined, SDG.id)" />
                                                    <p class="info-message text-danger" *ngIf="((fData.form.controls['stSituation'+char.characteristic.id]?.touched ? 
                                                            (char.startingSituation === undefined || char.startingSituation === '' || char.startingSituation === null)
                                                        : (char.startingSituation === undefined  || char.startingSituation === null) && clickedFormMap[activeIndex2] || tabIsValid[catidx] !== undefined && !tabIsValid[catidx]))
                                                        ">
                                                        This is a mandatory field
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="row p-2">
                                                <div class="col-4">Expected impact <i class="pi pi-info-circle" pTooltip="Please describe the value of the indicator after intervention implementation." tooltipPosition="bottom" style="font-size: 1rem"></i></div>
                                                <div class="col-8">
                                                    <input type="text" [name]="'impact'+char.characteristic.id+SDG.id" #tboundrary="ngModel" placeholder="Please describe the expected emissions reductions on the indicated scale." [(ngModel)]="char.expectedImpact" class="form-control"
                                                        [required]="true" (mouseleave)="autoSaveResult(category.code, true, category.code, 'out', char.characteristic.id, undefined, SDG.id)"/>
                                                    <p class="info-message text-danger" *ngIf="((fData.form.controls['impact'+char.characteristic.id]?.touched ? 
                                                                (char.expectedImpact === undefined || char.expectedImpact === '' || char.expectedImpact === null)
                                                            : (char.expectedImpact === undefined || char.expectedImpact === null) && clickedFormMap[activeIndex2] || tabIsValid[catidx] !== undefined && !tabIsValid[catidx]))
                                                            ">
                                                        This is a mandatory field
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="row p-2">
                                                <div class="col-4">Score</div>
                                                <div class="col-8">
                                                    <p-dropdown *ngIf="approach !== 'INDIRECT'" [name]="'score'+SDG.code+char.characteristic.id" #type="ngModel" placeholder="Select score" [(ngModel)]="char.selectedScore" [virtualScroll]="true" [virtualScrollItemSize]="20" [style]="{'width': '100%'}"
                                                        (onChange)="onSelectScore($event, char, idx, SDG.id); autoSaveResult(category.code, true, category.code, 'out', char.characteristic.id, undefined, SDG.id)" [options]="SDG_scale_score" optionLabel="name" [required]="true" appendTo="body">
                                                        <ng-template let-option pTemplate="item">
                                                            <div class="custom-option">
                                                                {{ option.name }}
                                                            </div>
                                                        </ng-template>
                                                    </p-dropdown>
                                                    <p class="info-message text-danger" *ngIf="((fData.form.controls['score'+SDG.code+char.characteristic.id]?.touched ? 
                                                            (char.selectedScore.code === undefined || char.selectedScore.code === '' || char.selectedScore.code === null)
                                                        : (char.selectedScore.code === undefined || char.selectedScore.code === null) && clickedFormMap[activeIndex2] || tabIsValid[catidx] !== undefined && !tabIsValid[catidx]))
                                                        ">
                                                        This is a mandatory field
                                                    </p>
                                                    <p-dropdown *ngIf="approach === 'INDIRECT'" name="institution" [options]="institutions" [(ngModel)]="char.institution" #finstitution="ngModel" placeholder="Select an institution" optionLabel="name" [required]="true"></p-dropdown>
                                                </div>
                                            </div>
                                            <div class="row p-2">
                                                <div class="col-4">Justification <i *ngIf="['NATIONAL', 'SUBNATIONAL'].includes(char.characteristic.code)" class="pi pi-info-circle" pTooltip="{{char.characteristic.code === 'NATIONAL' ? sectoral_placeholder : subsectoral_placeholder}}"
                                                        tooltipPosition="bottom" style="font-size: 1rem"></i></div>
                                                <div class="col-6">
                                                    <textarea rows="5" type="text" [name]="'justification'+SDG.code+char.characteristic.id" [(ngModel)]="char.comment" class="form-control" [placeholder]="char.characteristic.code === 'INTERNATIONAL' ? 'Enter justification' : ''"
                                                        [required]="true" [maxlength]="masterDataService.getFieldCharCount(fieldNames.JUSTIFICATION)" (mouseleave)="autoSaveResult(category.code, true, category.code, 'out', char.characteristic.id, undefined, SDG.id)"></textarea>
                                                    <span style="font-size: 1rem; float: right;">Maximum characters {{masterDataService.getFieldCharCount(fieldNames.JUSTIFICATION)}}</span>
                                                    <p class="info-message text-danger" *ngIf="((fData.form.controls['justification'+SDG.code+char.characteristic.id]?.touched ? 
                                                            (char.comment === undefined || char.comment === '' || char.comment === null)
                                                        : (char.comment === undefined || char.comment === null) && clickedFormMap[activeIndex2] || tabIsValid[catidx] !== undefined && !tabIsValid[catidx]))
                                                        ">
                                                        This is a mandatory field
                                                    </p>
                                                </div>
                                                <div class="col-2">
                                                    <p-fileUpload mode="basic" chooseIcon="pi pi-upload" chooseLabel="Upload" name="files" [url]="uploadUrl" (onUpload)="onUpload($event,char); autoSaveResult(category.code, true, category.code, 'out', char.characteristic.id, undefined, SDG.id)" [multiple]="true" accept="{{acceptedFiles}}" [maxFileSize]="5000000" [auto]="true">
                                                    </p-fileUpload>
                                                </div>
                                            </div>
                                            <div class="row p-2" *ngIf="char.filePath">
                                                <div class="col-4"></div>
                                                <div class="col-4">
                                                    <p class="col-5">{{char.filePath}}</p>
                                                </div>
                                                <div class="col-4">
                                                    <a target="_blank" [href]="fileServerURL+'/'+char.filePath"><i class="pi pi-download download col-4"></i></a>
                                                </div>
                                            </div>
                                        </ng-container>
                                    </ng-container>
                                    <ng-container *ngIf="category.method === 'SUSTAINED'">
                                        <ng-container *ngFor="let chSus of SDG.sustainResult; let idx = index">
                                            <h6>{{idx+1}}. {{chSus.characteristic.name}}</h6>
                                            <p>Is the intervention’s contribution to the selected SDG sustained in nature?</p>
                                            <div class="row p-2">
                                                <div class="col-4">Score</div>
                                                <div class="col-6">
                                                    <p-dropdown *ngIf="approach !== 'INDIRECT'" [name]="'susScore'+SDG.code+chSus.characteristic.id" #type="ngModel" placeholder="Select score" [(ngModel)]="chSus.selectedScore" [virtualScroll]="true" [virtualScrollItemSize]="20"
                                                        [style]="{'width': '100%'}" (onChange)="onSelectScore($event, chSus, idx, SDG.id);autoSaveResult(category.code, true, category.code, 'out', chSus.characteristic.id, undefined, SDG.id)" [options]="SDG_sustained_score" optionLabel="name" [required]="true" appendTo="body">
                                                        <ng-template let-option pTemplate="item">
                                                            <div class="custom-option">
                                                                {{ option.name }}
                                                            </div>
                                                        </ng-template>
                                                    </p-dropdown>
                                                    <p class="info-message text-danger" *ngIf="((fData.form.controls['susScore'+SDG.code+chSus.characteristic.id]?.touched ? 
                                                            (chSus.selectedScore.code === undefined || chSus.selectedScore.code === '')
                                                        : chSus.selectedScore.code === undefined && clickedFormMap[activeIndex2] || tabIsValid[catidx] !== undefined && !tabIsValid[catidx]))
                                                        ">
                                                        This is a mandatory field
                                                    </p>
                                                    <p-dropdown *ngIf="approach === 'INDIRECT'" name="institution" [options]="institutions" [(ngModel)]="chSus.institution" #finstitution="ngModel" placeholder="Select an institution" optionLabel="name" [required]="true"></p-dropdown>
                                                </div>
                                            </div>
                                            <div class="row p-2">
                                                <div class="col-4">Justification</div>
                                                <div class="col-6">
                                                    <textarea rows="5" type="text" [name]="'susJustification'+SDG.code+chSus.characteristic.id" [(ngModel)]="chSus.comment" class="form-control" placeholder="Enter justification" [required]="true"
                                                        [maxlength]="masterDataService.getFieldCharCount(fieldNames.JUSTIFICATION)" (mouseleave)="autoSaveResult(category.code, true, category.code, 'out', chSus.characteristic.id, undefined, SDG.id)"></textarea>
                                                    <span style="font-size: 1rem; float: right;">Maximum characters {{masterDataService.getFieldCharCount(fieldNames.JUSTIFICATION)}}</span>
                                                    <p class="info-message text-danger" *ngIf="((fData.form.controls['susJustification'+SDG.code+chSus.characteristic.id]?.touched ? 
                                                            (chSus.comment === undefined || chSus.comment === '' || chSus.comment === null)
                                                        : (chSus.comment === undefined || chSus.comment === null) && clickedFormMap[activeIndex2] || tabIsValid[catidx] !== undefined && !tabIsValid[catidx]))
                                                        ">
                                                        This is a mandatory field
                                                    </p>
                                                </div>
                                                <div class="col-2">
                                                    <p-fileUpload mode="basic" chooseIcon="pi pi-upload" chooseLabel="Upload" name="files" [url]="uploadUrl" (onUpload)="onUpload($event,chSus);autoSaveResult(category.code, true, category.code, 'out', chSus.characteristic.id, undefined, SDG.id)" [multiple]="true" accept="{{acceptedFiles}}" [maxFileSize]="5000000" [auto]="true">
                                                    </p-fileUpload>
                                                </div>
                                            </div>
                                            <div class="row p-2" *ngIf="chSus.filePath">
                                                <div class="col-4"></div>
                                                <div class="col-4">
                                                    <p class="col-5">{{chSus.filePath}}</p>
                                                </div>
                                                <div class="col-4">
                                                    <a target="_blank" [href]="fileServerURL+'/'+chSus.filePath"><i class="pi pi-download download col-4"></i></a>
                                                </div>
                                            </div>
                                        </ng-container>
                                    </ng-container>
                                </div>
                            </ng-container>
                            <ng-container *ngIf="category.method === 'SUSTAINED'">
                                <h6>SDG score</h6>
                                <div class="row p-2">
                                    <div class="col-4">Aggregated score</div>
                                    <div class="col-8">
                                        <input type="text" name="sdgScore" #tboundrary="ngModel" disabled="true" [(ngModel)]="SDGScore" class="form-control" />
                                    </div>
                                </div>
                            </ng-container>
                        </ng-container>
                        <div class="row justify-content-end" *ngIf="activeIndex2 < outcome.length - 1">
                            <div>
                                <div class="d-flex flex-row-reverse mt-20 ">
                                    <div class="btn btn-primary" (click)="next(category.type+'_'+category.method)">
                                        Next
                                    </div>
                                    <div style="margin-right: 10px;" class="btn btn-primary" (click)="submit(category.type+'_'+category.method, isCompleted ? false : true,category.code,'out')">
                                        {{isCompleted ? 'Update' : 'Save'}}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </ng-container>
                </form>
                <div class="row justify-content-end" *ngIf="activeIndex2 === outcome.length - 1">
                    <div>
                        <div class="d-flex flex-row-reverse mt-20 ">
                            <button [disabled]="savedData || notFilledCategories.length > 0" class="btn btn-primary" (click)="submit('',false,'','')">
                                {{ approach === 'INDIRECT' ? 'Send to Data Collection Team' : 'Calculate & check results'
                                }}
                            </button>
                        </div>
                        <div class="d-flex flex-row-reverse mt-20 ">
                            <span style="color: brown;" *ngIf="notFilledCategories.length > 0">{{getNotFilledCaution()}}</span>
                        </div>
                    </div>
                </div>
            </p-tabPanel>
        </p-tabView>
    </p-tabPanel>
</p-tabView>

<p-overlayPanel #opRelevance [style]="{'width': '800px'}">
    <div class="p-grid p-fluid col-md-12 col-sm-12 text-title">
        <label>Does the process characteristic affect/impact any of the identified barriers? Does the intervention affect or is affected by this process characteristic?</label>
        <br><br>
        <p-table [value]="[{}]">
            <ng-template pTemplate="header">
                <tr>
                    <th>Relevance</th>
                    <th>Description</th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-row>
                <tr>
                    <td>Relevant</td>
                    <td>Reason to believe that a characteristic is important for transformational change in the context of the intervention</td>
                </tr>
                <tr>
                    <td>Possibly relevant</td>
                    <td>Not clear whether the characteristic is important for transformational change in the context of the intervention. Where the relevance is unknown or cannot be determined, the characteristic should be monitored over time.</td>
                </tr>
                <tr>
                    <td>Not relevant</td>
                    <td>Reason to believe that the characteristic is not important for transformational change in the context of the intervention.</td>
                </tr>
            </ng-template>
        </p-table>
    </div>
</p-overlayPanel>
<p-confirmDialog></p-confirmDialog>

<p-confirmDialog key="autosave" header="Confirmation" icon="pi pi-exclamation-triangle"></p-confirmDialog>